# Command Center Publishing Framework (CCPF)

The **Command Center Publishing Framework** (**CCPF**) is an opinionated  approach to
publishing websites using static site generators (SSGs) like Hugo.

Most SSGs, such as Hugo, do a good job with taking static files in Markdown and
similar assets but do not usually support pre-processing of page content or 
large scale page content generation from dynamic data (such as a SQL
databases or other third-party applications such as code analysis tools, ticket
management systems, and a variety of other data sources).

The CCPF's job is to fill the gaps of page generation and edge side includes
(ESIs).

Limitations:

* Only Hugo has been tested, but other SSGs should be possible.

Prerequisites:

* Linux server, tested only on Ubuntun 18.04 LTS
* user with sudo privileges for setting up some common utilities
* curl

Included:

* Jsonnet, jq, Hugo, PlantUML jar

Installed, if not available:

* Git, Graphviz

Vendored:

* Google Go, Mage, Java

## CCPF Functionality

The CCPF defines a set of strategies and utilities that allows:

* Normal processing of SSG content for site generators like Hugo. The CCPF's
  core philosophy is to build around or on top of SSGs, not replace them. For
  now, we only support Hugo but other SSGs should be easy to add later.
* Running GraphQL and generating SSG content from the results of the queries
* Running SQL and generating content pages from the results of the queries
* Creating server-side JSON, CSV, etc. includes that can be included in SSG 
  content
* Creating client-side edge side includes (ESIs) for portions of an SSG which
  are dynamic.

## Installing CCPF

You can setup a new project using:

    mkdir <project-name>
    cd <project-name>
    curl -s https://raw.githubusercontent.com/shah/static-site-publishing-framework/master/bin/setup-CCPF.sh | bash

## Upgrading CCPF

You can upgrade an existing project using:

    cd <project-name>
    make upgrade-CCPF

## CCPF-specific Files

These directories and files are typically managed by CCPF and will be replaced
when doing an upgrade:

* **bin/hugo-(version)**. Hugo static site generator binary.
* **bin/jsonnet-(version)**. Google Jsonnet data templating library binary.
* **Makefile**. Central Makefile which drives all other commands and utilities.
* **tmp** directory. Temporary files created during CCPF's generation process 
  reside here. This should not be tracked by git (include it in .gitignore).
* **vendor** directory. Google Go (e.g. Mage) and other custom libraries reside
  here. Only required during the CCPF code generation process, not in final 
  publication (which is HTML static site).

## CCPF Suggested Project Directory Structure

The following directory structure is the recommended approach to storing
various CCPF artifacts:

* **etc**. Configuration files for binaries and scripts that are used by the
  CCPF utilities and Makefiles.
* **publication**. This directory contains the final, static content, that is 
  to be served by web servers. It could be cloned as a remote git submodule so 
  that git hooks can be created to automatically publish it to Netlify or other 
  SSG hosts when you push the latest version. Or, this directory can be the 
  source of a container-based webserver (if part of a Dockerfile multi-stage 
  build).
* **ssg-primary**. The directory in which the content which an SSG (e.g. Hugo) 
  would typically manage on its own would reside here. This can be a remote git
  submodule for the most flexibility. For pages that are generated by CCPF, 
  content may be either directly generated in this directory or symlink'd from 
  this directory to other parts of the CCPF (e.g. **include** directory). This
  directory is called _ssg-primary_ because there may be more than one.
* **support**. CCPF documentation and other support collateral reside here.
* **tasks**. Custom Makefiles, Mage scripts, and other task runner code resides
  here.
